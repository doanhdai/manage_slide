<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bảng Điều Khiển - Quản Lý Yêu Cầu Bài Giảng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* Custom CSS for things we can't do with Tailwind */
      .smooth-transition {
        transition: all 0.3s ease-in-out;
      }

      .modal-backdrop {
        background-color: rgba(0, 0, 0, 0.5);
      }

      .status-new {
        background-color: #e3f2fd;
        color: #1976d2;
      }

      .status-creating {
        background-color: #fff8e1;
        color: #ffa000;
      }

      .status-created {
        background-color: #e8f5e9;
        color: #388e3c;
      }
      .active {
        background-color: #e0e7ff; /* Ví dụ màu nền xanh nhạt */
        color: #3730a3; /* Ví dụ màu chữ xanh đậm */
        font-weight: bold;
      }

      .lecture-name-hover:hover {
        text-decoration: underline;
        cursor: pointer;
      }

      @media (max-width: 768px) {
        .responsive-table-row {
          flex-direction: column;
          gap: 0.5rem;
          padding: 1rem;
        }

        .responsive-table-cell {
          border-bottom: 1px solid #e2e8f0;
          padding: 0.5rem 0;
        }

        .responsive-table-cell:last-child {
          border-bottom: none;
        }

        .responsive-table-header {
          display: none;
        }
      }
    </style>
  </head>
  <body class="bg-gray-100 font-sans">
    <div class="min-h-screen flex flex-col">
      <!-- Header -->
      <header class="bg-white shadow-md py-4 px-6">
        <div class="flex justify-between items-center">
          <h1 class="text-2xl font-bold text-indigo-700">Bảng Điều Khiển</h1>
          <div class="flex items-center space-x-4">
            <button
              class="p-2 rounded-full bg-gray-100 hover:bg-gray-200 smooth-transition"
            >
              <i class="fas fa-bell text-gray-600"></i>
            </button>
            <div
              class="w-10 h-10 rounded-full bg-indigo-500 flex items-center justify-center text-white font-semibold"
            >
              AD
            </div>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <div class="flex flex-1">
        <!-- Sidebar -->
        <aside class="w-64 bg-white shadow-md hidden md:block">
          <nav class="p-4">
            <ul class="space-y-2">
              <li>
                <a
                  href="#"
                  class="flex items-center p-2 rounded-lg"
                  id="LectureRequests"
                >
                  <i class="fas fa-chalkboard-teacher mr-3"></i>
                  <span>Yêu Cầu Bài Giảng</span>
                </a>
              </li>
              <li>
                <a
                  href="#"
                  class="flex items-center p-2 rounded-lg hover:bg-gray-100 smooth-transition"
                  id="lessons"
                >
                  <i class="fas fa-book mr-3"></i>
                  <span>Bài Học</span>
                </a>
              </li>
              <li>
                <a
                  href="#"
                  class="flex items-center p-2 rounded-lg hover:bg-gray-100 smooth-transition"
                >
                  <i class="fas fa-users mr-3"></i>
                  <span>Người Dùng</span>
                </a>
              </li>
              <li>
                <a
                  href="#"
                  class="flex items-center p-2 rounded-lg hover:bg-gray-100 smooth-transition"
                >
                  <i class="fas fa-cog mr-3"></i>
                  <span>Cài Đặt</span>
                </a>
              </li>
            </ul>
          </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 p-3 overflow-x-auto">
          <div class="bg-white rounded-lg shadow-md p-6">
            <!-- Page Header -->
            <div
              id="lectureRequestsHeader"
              class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4"
            >
              <h2 class="text-xl font-bold text-gray-800 mb-4 md:mb-0">
                Quản Lý Yêu Cầu Bài Giảng
              </h2>
              <button
                id="createRequestBtn"
                class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center smooth-transition"
              >
                <i class="fas fa-plus mr-2"></i>
                Tạo Yêu Cầu
              </button>
            </div>

            <!-- Lessons Header -->
            <div
              id="lessonsHeader"
              class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 mt-2 hidden"
            >
              <h2 class="text-xl font-bold text-gray-800 mb-4 md:mb-0">
                Quản Lý Bài Học
              </h2>
            </div>

            <!-- Search and Filters -->
            <div class="mb-6">
              <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                <div class="md:col-span-2">
                  <input
                    type="text"
                    id="searchInput"
                    placeholder="Tìm kiếm theo tên bài giảng..."
                    class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                  />
                </div>
                <div>
                  <select
                    id="subjectFilter"
                    class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                  >
                    <option value="">Tất Cả Môn Học</option>
                    <option value="Math">Toán</option>
                    <option value="Science">Khoa Học</option>
                    <option value="English">Tiếng Anh</option>
                    <option value="History">Lịch Sử</option>
                  </select>
                </div>
                <div>
                  <select
                    id="statusFilter"
                    class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                  >
                    <option value="">Tất Cả Trạng Thái</option>
                    <option value="New">Mới</option>
                    <option value="Creating">Đang Tạo</option>
                    <option value="Created">Đã Tạo</option>
                  </select>
                </div>
                <div>
                  <select
                    id="chapterFilter"
                    class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                  >
                    <option value="">Tất Cả Chương</option>
                    <option value="Chapter 1">Chương 1</option>
                    <option value="Chapter 2">Chương 2</option>
                    <option value="Chapter 3">Chương 3</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Requests Table -->
            <div class="overflow-x-auto">
              <table class="min-w-full bg-white">
                <thead class="responsive-table-header">
                  <tr
                    class="bg-gray-50 text-left text-gray-700 uppercase text-sm"
                  >
                    <th class="py-2 px-2">ID</th>
                    <th class="py-2 px-2">Tên Bài Giảng</th>
                    <th class="py-2 px-2">Ngày Tạo</th>
                    <th class="py-2 px-2">Người Yêu Cầu</th>
                    <th class="py-2 px-2">Môn Học</th>
                    <th class="py-2 px-2">Chương</th>
                    <th class="py-2 px-2">Link Bài Giảng</th>
                    <th class="py-2 px-2">Trạng Thái</th>
                    <th class="py-2 px-2">Thao Tác</th>
                  </tr>
                </thead>
                <tbody id="requestsTableBody" class="divide-y divide-gray-200">
                  <!-- Data will be populated here -->
                </tbody>
              </table>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="text-center py-10 hidden">
              <i class="fas fa-inbox text-4xl text-gray-300 mb-3"></i>
              <h3 class="text-lg font-medium text-gray-500">
                Không tìm thấy yêu cầu bài giảng nào
              </h3>
              <p class="text-gray-400 mt-1">
                Tạo yêu cầu bài giảng đầu tiên để bắt đầu
              </p>
            </div>

            <!-- Pagination -->
            <div class="flex justify-between items-center mt-6">
              <div class="text-sm text-gray-500">
                Hiển thị <span id="startItem">1</span> đến
                <span id="endItem">5</span> trong tổng số
                <span id="totalItems">12</span> mục
              </div>
              <div class="flex space-x-1">
                <button
                  class="px-3 py-1 rounded-lg border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 smooth-transition"
                >
                  <
                </button>
                <button
                  class="px-3 py-1 rounded-lg border border-gray-300 bg-indigo-600 text-white smooth-transition"
                >
                  1
                </button>
                <button
                  class="px-3 py-1 rounded-lg border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 smooth-transition"
                >
                  2
                </button>
                <button
                  class="px-3 py-1 rounded-lg border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 smooth-transition"
                >
                  >
                </button>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Create Request Modal -->
    <div
      id="createRequestModal"
      class="fixed inset-0 z-50 flex items-center justify-center hidden"
    >
      <div class="modal-backdrop absolute inset-0"></div>
      <div
        class="bg-white rounded-lg shadow-xl z-10 w-full max-w-2xl mx-4 smooth-transition"
      >
        <div class="p-6">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-semibold text-gray-800">
              Tạo Yêu Cầu Bài Giảng Mới
            </h3>
            <button
              id="closeCreateModal"
              class="text-gray-400 hover:text-gray-500"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>
          <form id="requestForm" class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label
                  for="subject"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Môn Học</label
                >
                <select
                  id="subject"
                  required
                  class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                >
                  <option value="">Chọn Môn Học</option>
                  <option value="Math">Toán</option>
                  <option value="Science">Khoa Học</option>
                  <option value="English">Tiếng Anh</option>
                  <option value="History">Lịch Sử</option>
                </select>
              </div>
              <div>
                <label
                  for="chapter"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Chương</label
                >
                <select
                  id="chapter"
                  required
                  class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                >
                  <option value="">Chọn Chương</option>
                  <option value="Chapter 1">Chương 1</option>
                  <option value="Chapter 2">Chương 2</option>
                  <option value="Chapter 3">Chương 3</option>
                </select>
              </div>
            </div>

            <div>
              <label
                for="lectureName"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Tên Bài Giảng</label
              >
              <input
                type="text"
                id="lectureName"
                required
                class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
              />
            </div>
            <div>
              <label
                for="linkGenspack"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Liên Kết Genspack</label
              >
              <input
                type="text"
                id="linkGenspack"
                required
                class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
              />
            </div>
            <div>
              <label
                for="description"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Mô Tả (Tùy Chọn)</label
              >
              <textarea
                id="description"
                rows="3"
                class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
              ></textarea>
            </div>
            <div class="flex justify-end space-x-3 pt-4">
              <button
                type="button"
                id="cancelRequest"
                class="px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-700 hover:bg-gray-50 smooth-transition"
              >
                Cancel
              </button>
              <button
                type="submit"
                class="px-4 py-2 bg-indigo-600 rounded-lg text-white hover:bg-indigo-700 smooth-transition"
              >
                Tạo Yêu Cầu
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div
      id="deleteConfirmModal"
      class="fixed inset-0 z-50 flex items-center justify-center hidden"
    >
      <div class="modal-backdrop absolute inset-0"></div>
      <div
        class="bg-white rounded-lg shadow-xl z-10 w-full max-w-md mx-4 smooth-transition"
      >
        <div class="p-6">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-semibold text-gray-800">Xác Nhận Xóa</h3>
            <button
              id="closeDeleteModal"
              class="text-gray-400 hover:text-gray-500"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>
          <p class="text-gray-600 mb-6">
            Bạn có chắc chắn muốn xóa yêu cầu bài giảng này? Hành động này không
            thể hoàn tác.
          </p>
          <div class="flex justify-end space-x-3">
            <button
              id="cancelDelete"
              class="px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-700 hover:bg-gray-50 smooth-transition"
            >
              Hủy
            </button>
            <button
              id="confirmDelete"
              class="px-4 py-2 bg-red-600 rounded-lg text-white hover:bg-red-700 smooth-transition"
            >
              Xóa
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- View/Edit Lecture Modal -->
    <div
      id="viewLectureModal"
      class="fixed inset-0 z-50 flex items-center justify-center hidden"
    >
      <div class="modal-backdrop absolute inset-0"></div>
      <div
        class="bg-white rounded-lg shadow-xl z-10 w-full max-w-2xl mx-4 smooth-transition"
      >
        <div class="p-6">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-semibold text-gray-800">
              Thông Tin Bài Giảng
            </h3>
            <button
              id="closeViewModal"
              class="text-gray-400 hover:text-gray-500"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>
          <form id="viewLectureForm" class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label
                  for="viewSubject"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Môn Học</label
                >
                <input
                  type="text"
                  id="viewSubject"
                  readonly
                  class="w-full p-2 border border-gray-300 rounded-lg bg-gray-50"
                />
              </div>
              <div>
                <label
                  for="viewChapter"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Chương</label
                >
                <input
                  type="text"
                  id="viewChapter"
                  readonly
                  class="w-full p-2 border border-gray-300 rounded-lg bg-gray-50"
                />
              </div>
            </div>

            <div>
              <label
                for="viewLectureName"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Tên Bài Giảng</label
              >
              <input
                type="text"
                id="viewLectureName"
                readonly
                class="w-full p-2 border border-gray-300 rounded-lg bg-gray-50"
              />
            </div>
            <div>
              <label
                for="viewLinkGenspack"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Liên Kết Genspack</label
              >
              <input
                type="text"
                id="viewLinkGenspack"
                readonly
                class="w-full p-2 border border-gray-300 rounded-lg bg-gray-50"
              />
            </div>
            <div>
              <label
                for="viewDescription"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Mô Tả</label
              >
              <textarea
                id="viewDescription"
                rows="3"
                class="w-full p-2 border border-gray-300 rounded-lg"
              ></textarea>
            </div>
            <div class="flex justify-end space-x-3 pt-4">
              <button
                type="button"
                id="closeViewForm"
                class="px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-700 hover:bg-gray-50 smooth-transition"
              >
                Đóng
              </button>
              <button
                type="submit"
                id="saveDescriptionBtn"
                class="px-4 py-2 bg-indigo-600 rounded-lg text-white hover:bg-indigo-700 smooth-transition hidden"
              >
                Lưu Mô Tả
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      // Sample data for the lecture requests
      let lectureRequests = [];

      // DOM Elements
      const requestsTableBody = document.getElementById("requestsTableBody");
      const lessonBtn = document.getElementById("lessons");
      const LectureRequests = document.getElementById("LectureRequests");
      const emptyState = document.getElementById("emptyState");
      const createRequestBtn = document.getElementById("createRequestBtn");
      const createRequestModal = document.getElementById("createRequestModal");
      const closeCreateModal = document.getElementById("closeCreateModal");
      const cancelRequest = document.getElementById("cancelRequest");
      const requestForm = document.getElementById("requestForm");
      const deleteConfirmModal = document.getElementById("deleteConfirmModal");
      const closeDeleteModal = document.getElementById("closeDeleteModal");
      const cancelDelete = document.getElementById("cancelDelete");
      const confirmDelete = document.getElementById("confirmDelete");
      const searchInput = document.getElementById("searchInput");
      const subjectFilter = document.getElementById("subjectFilter");
      const statusFilter = document.getElementById("statusFilter");
      const chapterFilter = document.getElementById("chapterFilter");
      const lectureRequestsHeader = document.getElementById(
        "lectureRequestsHeader"
      );
      const deletebtn = document.getElementsByClassName("delete-request-btn");
      const lessonsHeader = document.getElementById("lessonsHeader");
      const viewLectureModal = document.getElementById("viewLectureModal");
      const closeViewModal = document.getElementById("closeViewModal");
      const closeViewForm = document.getElementById("closeViewForm");
      const viewLectureForm = document.getElementById("viewLectureForm");
      const saveDescriptionBtn = document.getElementById("saveDescriptionBtn");
      let currentLectureId = null;

      // Variables for deletion
      let requestToDelete = null;

      // Initialize the page
      document.addEventListener("DOMContentLoaded", async function () {
        renderRequests(lectureRequests);
        LectureRequests.classList.add("active");
        lectureRequestsHeader.classList.remove("hidden");
        lessonsHeader.classList.add("hidden");

        lessonBtn.addEventListener("click", () => {
          renderLessons(lectureRequests);
          lessonBtn.classList.add("active");
          LectureRequests.classList.remove("active");
          lectureRequestsHeader.classList.add("hidden");
          lessonsHeader.classList.remove("hidden");
        });

        LectureRequests.addEventListener("click", () => {
          renderRequests(lectureRequests);
          LectureRequests.classList.add("active");
          lessonBtn.classList.remove("active");
          lectureRequestsHeader.classList.remove("hidden");
          lessonsHeader.classList.add("hidden");
        });

        // Modal toggle events
        createRequestBtn.addEventListener("click", () => {
          createRequestModal.classList.remove("hidden");
          console.log();
        });

        closeCreateModal.addEventListener("click", () => {
          createRequestModal.classList.add("hidden");
        });

        cancelRequest.addEventListener("click", () => {
          createRequestModal.classList.add("hidden");
        });

        closeDeleteModal.addEventListener("click", () => {
          deleteConfirmModal.classList.add("hidden");
        });

        cancelDelete.addEventListener("click", () => {
          deleteConfirmModal.classList.add("hidden");
        });

        // View lecture modal events
        closeViewModal.addEventListener("click", () => {
          viewLectureModal.classList.add("hidden");
        });

        closeViewForm.addEventListener("click", () => {
          viewLectureModal.classList.add("hidden");
        });

        // View lecture form submission
        viewLectureForm.addEventListener("submit", async function (e) {
          e.preventDefault();
          if (!currentLectureId) return;
          try {
            const response = await fetch(
              `http://localhost:3000/api/lecture-requests/${currentLectureId}`,
              {
                method: "PATCH",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  description: document.getElementById("viewDescription").value,
                }),
              }
            );

            if (!response.ok) {
              throw new Error("Không thể cập nhật mô tả");
            }

            // Cập nhật dữ liệu trong danh sách
            const updatedLecture = lectureRequests.find(
              (l) => l.id === currentLectureId
            );
            if (updatedLecture) {
              updatedLecture.description =
                document.getElementById("viewDescription").value;
              renderRequests(lectureRequests);
            }

            viewLectureModal.classList.add("hidden");
            alert("Cập nhật mô tả thành công!");
          } catch (error) {
            console.error("Lỗi khi cập nhật mô tả:", error);
            alert(error.message || "Đã có lỗi xảy ra khi cập nhật mô tả!");
          }
        });

        try {
          const response = await fetch(
            "http://localhost:3000/api/lecture-requests"
          );
          if (!response.ok) throw new Error("Failed to fetch data");
          lectureRequests = await response.json();
          console.log(lectureRequests);

          // Chuyển đổi dữ liệu nếu cần (ví dụ định dạng ngày hoặc gộp field)
          lectureRequests = lectureRequests.map((item) => ({
            id: item.id,
            createdAt: new Date(item.created_at).toISOString().split("T")[0],
            requester: item.full_name || item.username || "Unknown",
            lectureName: item.lecture_name || "Untitled",
            subject: item.subject || "General",
            chapter: item.chapter || "",
            lectureLink: item.lecture_link || "",
            status: item.status || "New",
            description: item.description || "",
            link_genspack: item.link_genspack || "",
          }));

          renderRequests(lectureRequests);
        } catch (error) {
          console.error("Lỗi khi lấy dữ liệu từ server:", error);
          emptyState.classList.remove("hidden");
        }
        // Form submission
        requestForm.addEventListener("submit", async function (e) {
          e.preventDefault();

          // Create new request
          const newRequest = {
            lecture_name: document.getElementById("lectureName").value,
            subject: document.getElementById("subject").value,
            chapter: document.getElementById("chapter").value,
            link_genspack: document.getElementById("linkGenspack").value,
            description: document.getElementById("description").value,
            user_id: 1,
          };

          try {
            const response = await fetch(
              "http://localhost:3000/api/lecture-requests",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(newRequest),
              }
            );

            if (!response.ok) {
              const errorData = await response.json();
              throw new Error(errorData.error || "Không thể thêm bài giảng");
            }

            const result = await response.json();
            console.log("Kết quả thêm bài giảng:", result);

            // Thêm bài giảng vào danh sách hiển thị
            lectureRequests.unshift({
              id: result.id,
              createdAt: new Date().toISOString().split("T")[0],
              requester: result.full_name || "Admin",
              lectureName: result.lecture_name,
              subject: result.subject,
              chapter: result.chapter,
              lectureLink: result.lecture_link || "",
              status: result.status || "New",
              description: result.description || "",
              link_genspack: result.link_genspack || "",
            });

            // Cập nhật giao diện
            renderRequests(lectureRequests);
            requestForm.reset();
            createRequestModal.classList.add("hidden");
          } catch (error) {
            console.error("Lỗi khi thêm bài giảng:", error);
            alert(error.message || "Đã có lỗi xảy ra khi thêm bài giảng!");
          }
        });

        // Filter events
        searchInput.addEventListener("input", filterRequests);
        subjectFilter.addEventListener("change", filterRequests);
        statusFilter.addEventListener("change", filterRequests);
        chapterFilter.addEventListener("change", filterRequests);

        document.addEventListener("click", function (e) {
          if (e.target.classList.contains("view-present-btn")) {
            e.preventDefault();
            const lectureId = e.target.getAttribute("data-id");
            const lecture = lectureRequests.find(
              (l) => l.id === parseInt(lectureId)
            );

            if (lecture && lecture.status === "Created") {
              window.location.href = `index.html?lectureId=${lectureId}`;
            }
          }
        });

        // Add click event for lecture ID
        document.addEventListener("click", async function (e) {
          if (e.target.classList.contains("view-lecture-btn")) {
            e.preventDefault();
            const lectureId = e.target.getAttribute("data-id");
            const lecture = lectureRequests.find(
              (l) => l.id === parseInt(lectureId)
            );

            if (lecture) {
              // Nếu chưa tạo, hiển thị thông tin bài giảng như cũ
              currentLectureId = lectureId;
              document.getElementById("viewSubject").value = lecture.subject;
              document.getElementById("viewChapter").value = lecture.chapter;
              document.getElementById("viewLectureName").value =
                lecture.lectureName;
              document.getElementById("viewLinkGenspack").value =
                lecture.link_genspack || "";
              document.getElementById("viewDescription").value =
                lecture.description || "";

              const descriptionField =
                document.getElementById("viewDescription");
              const saveButton = document.getElementById("saveDescriptionBtn");

              if (lecture.status === "New") {
                descriptionField.readOnly = false;
                descriptionField.classList.remove("bg-gray-50");
                saveButton.classList.remove("hidden");
              } else {
                descriptionField.readOnly = true;
                descriptionField.classList.add("bg-gray-50");
                saveButton.classList.add("hidden");
              }

              viewLectureModal.classList.remove("hidden");
            }
          }
        });

        // Xử lý sự kiện xóa
        document.addEventListener("click", async function (e) {
          if (e.target.closest(".delete-request-btn")) {
            e.preventDefault();
            const lectureId = e.target
              .closest(".delete-request-btn")
              .getAttribute("data-id");
            requestToDelete = lectureId;
            deleteConfirmModal.classList.remove("hidden");
          }
        });

        // Xác nhận xóa
        confirmDelete.addEventListener("click", async function () {
          if (requestToDelete) {
            try {
              const response = await fetch(
                `http://localhost:3000/api/lecture-requests/${requestToDelete}`,
                {
                  method: "DELETE",
                }
              );

              if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || "Không thể xóa bài giảng");
              }

              // Xóa bài giảng khỏi danh sách
              lectureRequests = lectureRequests.filter(
                (req) => req.id !== parseInt(requestToDelete)
              );
              renderRequests(lectureRequests);
              console.log(lectureRequests);

              // Đóng modal và reset biến
              deleteConfirmModal.classList.add("hidden");
              requestToDelete = null;
            } catch (error) {
              console.error("Lỗi khi xóa bài giảng:", error);
            }
          }
        });
      });

      // Render requests table
      function renderRequests(requests) {
        requestsTableBody.innerHTML = "";

        if (requests.length === 0) {
          emptyState.classList.remove("hidden");
          requestsTableBody.classList.add("hidden");
          return;
        }

        emptyState.classList.add("hidden");
        requestsTableBody.classList.remove("hidden");

        requests.forEach((request) => {
          const row = document.createElement("tr");
          console.log(request);
          row.className =
            "responsive-table-row hover:bg-gray-50 smooth-transition";

          // Status class mapping
          let statusClass = "";
          if (request.status === "New") statusClass = "status-new";
          else if (request.status === "Creating")
            statusClass = "status-creating";
          else if (request.status === "Created") statusClass = "status-created";

          const createBtnDisabled =
            request.status === "Creating" || request.status === "Created";

          row.innerHTML = `
                    <td class="responsive-table-cell py-2 px-2 font-medium text-gray-700">
                      <a href="#" class="text-indigo-600 hover:text-indigo-800 view-lecture-btn" data-id="${
                        request.id
                      }">
                        ${request.id}
                      </a>
                    </td>
                    <td class="responsive-table-cell py-2 px-2 view-present-btn ${
                      request.status === "Created" ? "lecture-name-hover" : ""
                    }" data-id="${request.id}">${request.lectureName}</td>
                    <td class="responsive-table-cell py-2 px-2">${
                      request.createdAt
                    }</td>
                    <td class="responsive-table-cell py-2 px-2">${
                      request.requester
                    }</td>
                    <td class="responsive-table-cell py-2 px-2">${
                      request.subject
                    }</td>
                    <td class="responsive-table-cell py-2 px-2">${
                      request.chapter || "N/A"
                    }</td>
                    <td class="responsive-table-cell py-2 px-2">
                        ${
                          request.lectureLink
                            ? `<div class="space-y-1">
                                <div><a href="index.html?lectureId=${request.id}" target="_blank" class="text-indigo-600 hover:underline">Giáo viên</a></div>
                                <div><a href="index.html?lectureId=${request.id}&mode=student" target="_blank" class="text-indigo-600 hover:underline">Học sinh</a></div>
                               </div>`
                            : '<span class="text-gray-400">N/A</span>'
                        }
                    </td>
                    <td class="responsive-table-cell py-2 px-2">
                        <span class="px-2 py-1 rounded-full text-xs font-semibold ${statusClass}">${
            request.status
          }</span>
                    </td>
                    <td class="responsive-table-cell py-2 px-2">
                        <div class="flex space-x-2">
                            <button class="create-lecture-btn p-2 rounded-lg ${
                              createBtnDisabled
                                ? "bg-gray-200 text-gray-500 cursor-not-allowed"
                                : "bg-indigo-100 text-indigo-700 hover:bg-indigo-200 smooth-transition"
                            }" 
                                    data-id="${request.id}" ${
            createBtnDisabled ? "disabled" : ""
          }>
                                ${
                                  request.status === "New"
                                    ? `<a href="index.html" target="_blank"><i class="fas fa-plus"></i> Create</a>`
                                    : `<i class="fas fa-plus"></i> Create`
                                }
                            </button>
                            <button class="delete-request-btn p-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 smooth-transition" data-id="${
                              request.id
                            }">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;

          requestsTableBody.appendChild(row);
        });

        // Add event listeners to newly created buttons
        document.querySelectorAll(".create-lecture-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            const requestId = this.getAttribute("data-id");
            createLecture(requestId);
          });
        });
      }

      // Create lecture function
      function createLecture(requestId) {
        const request = lectureRequests.find((req) => req.id === requestId);
        if (request) {
          request.status = "Creating";
          renderRequests(lectureRequests);

          // Simulate creation process
          setTimeout(() => {
            request.status = "Created";
            request.lectureLink = `https://example.com/lecture/${Math.floor(
              Math.random() * 1000
            )}`;
            renderRequests(lectureRequests);
          }, 3000);
        }
      }

      // Filter requests based on search and filters
      function filterRequests() {
        const searchTerm = searchInput.value.toLowerCase();
        const selectedSubject = subjectFilter.value;
        const selectedStatus = statusFilter.value;
        const selectedChapter = chapterFilter.value;

        const filteredRequests = lectureRequests.filter((request) => {
          const matchesSearch = request.lectureName
            .toLowerCase()
            .includes(searchTerm);
          const matchesSubject =
            selectedSubject === "" || request.subject === selectedSubject;
          const matchesStatus =
            selectedStatus === "" || request.status === selectedStatus;
          const matchesChapter =
            selectedChapter === "" || request.chapter === selectedChapter;

          return (
            matchesSearch && matchesSubject && matchesStatus && matchesChapter
          );
        });

        renderRequests(filteredRequests);
      }
    </script>
  </body>
</html>
