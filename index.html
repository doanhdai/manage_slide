<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>HTML Slide Editor - Enhanced UI</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Segoe UI", Arial, sans-serif;
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow: hidden;
        background: #f0f2f5;
      }

      .main-content-area {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 15px;
        overflow: hidden;
      }

      .topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 10px;
        border-bottom: 1px solid #ddd;
        background-color: #ffffff;
        padding: 10px 15px;
        border-radius: 8px 8px 0 0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .topbar h2 {
        margin: 0;
        font-size: 18px;
        color: #333;
      }

      .topbar button {
        background: #007bff;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s ease;
      }

      .topbar button:hover {
        background: #0056b3;
      }

      #preview {
        flex: 1;
        border: 1px solid #ccc;
        border-radius: 0 0 8px 8px;
        width: 100%;
        background: white;
        margin-top: -1px;
      }

      .bottom-slide-navigator {
        height: 160px;
        background: #ffffff;
        border-top: 1px solid #ddd;
        padding: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
        overflow: hidden;
      }

      .slide-list {
        list-style: none;
        padding: 0 5px;
        margin: 0;
        display: flex;
        gap: 10px;
        flex-grow: 1;
        height: 100%;
        overflow: hidden;
      }

      .slide-list li {
        position: relative;
        width: 140px;
        height: 110px;
        border: 1px solid #ccc;
        border-radius: 6px;
        background: #f9f9f9;
        cursor: pointer;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        overflow: hidden;
        flex-shrink: 0;
      }

      .slide-list li.active {
        border-color: #007bff;
        box-shadow: 0 0 0 2px #007bff;
      }

      .slide-list li:hover {
        border-color: #999;
      }

      .thumbnail-container {
        width: 140px;
        height: 78.75px;
        margin-top: 5px;
        overflow: hidden;
        border: 1px solid #eee;
        position: relative;
      }

      .thumbnail-container iframe {
        width: 100%;
        height: 100%;
        border: none;
        pointer-events: none;
        transform-origin: top left;
        background-color: #fff;
      }

      .slide-number {
        position: absolute;
        bottom: 3px;
        left: 5px;
        font-size: 10px;
        color: #333;
        background-color: rgba(255, 255, 255, 0.7);
        padding: 1px 3px;
        border-radius: 3px;
      }

      .add-slide-button-container {
        display: flex;
        align-items: center;
        justify-content: center;
        padding-left: 10px;
        height: 100%;
      }

      .bottom-slide-navigator button.add-slide {
        padding: 10px 15px;
        color: black;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        white-space: nowrap;
        transition: background-color 0.2s ease;
        height: fit-content;
      }
      .bottom-slide-navigator button.add-slide:hover {
        background: #218838;
      }

      .popup {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border: 1px solid #ccc;
        border-radius: 10px;
        padding: 20px;
        width: 600px;
        max-width: 90%;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        display: none;
        flex-direction: column;
        gap: 15px;
      }

      .popup h3 {
        margin: 0 0 5px 0;
        font-size: 18px;
        color: #333;
      }

      .popup textarea {
        width: 100%;
        height: 250px;
        font-family: "Consolas", "Courier New", monospace;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 10px;
        resize: vertical;
        font-size: 13px;
      }

      .popup-buttons {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }

      .popup-buttons button {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        color: white;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s ease;
      }

      .popup-buttons .save {
        background: #28a745;
      }
      .popup-buttons .save:hover {
        background: #218838;
      }

      .popup-buttons .close {
        background: #6c757d;
      }
      .popup-buttons .close:hover {
        background: #5a6268;
      }

      #presentation-container {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        z-index: 2000;
        justify-content: center;
        align-items: center;
      }

      #presentation-iframe {
        width: 100%;
        height: 100%;
        border: none;
      }

      .presentation-controls {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 20px;
      }

      .presentation-controls button {
        background: #fff;
        color: #000;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
      }

      .presentation-controls button:hover {
        background: #ddd;
      }

      .presentation-controls .exit {
        background: #ff4444;
        color: white;
      }

      .presentation-controls .exit:hover {
        background: #cc0000;
      }
    </style>
  </head>
  <body>
    <div class="main-content-area">
      <div class="topbar">
        <h2>Slide Preview</h2>
        <button onclick="Editor.showPopup()">‚úèÔ∏è Edit HTML</button>
        <button onclick="Editor.togglePresentation()">üé• Present</button>
      </div>
      <iframe id="preview"></iframe>
    </div>

    <div class="bottom-slide-navigator">
      <ul class="slide-list" id="slideList"></ul>
      <div class="add-slide-button-container">
        <button class="add-slide" onclick="Editor.addSlide()">
          ‚ûï Add Slide
        </button>
      </div>
    </div>

    <div id="popup" class="popup">
      <h3>Edit Slide HTML</h3>
      <textarea id="popupEditor"></textarea>
      <div class="popup-buttons">
        <button class="close" onclick="Editor.hidePopup()">‚ùå Close</button>
        <button class="save" onclick="Editor.savePopup()">
          üíæ Save & Preview
        </button>
      </div>
    </div>

    <div id="presentation-container">
      <iframe id="presentation-iframe"></iframe>
      <div class="presentation-controls">
        <button onclick="Editor.prevSlide()">‚¨ÖÔ∏è Prev</button>
        <button onclick="Editor.nextSlide()">‚û°Ô∏è Next</button>
        <button class="exit" onclick="Editor.exitPresentation()">
          üö™ Exit
        </button>
      </div>
    </div>

    <script>
      const Editor = (() => {
        const slideListEl = document.getElementById("slideList");
        const popupEditor = document.getElementById("popupEditor");
        const previewFrame = document.getElementById("preview");
        const popup = document.getElementById("popup");
        const presentationContainer = document.getElementById(
          "presentation-container"
        );
        const presentationIframe = document.getElementById(
          "presentation-iframe"
        );

        let slides = [""];
        let currentSlide = 0;

        const THUMBNAIL_CONTENT_ASPECT_RATIO = 16 / 9;
        const THUMBNAIL_CONTAINER_WIDTH = 140;
        const THUMBNAIL_CONTAINER_HEIGHT =
          THUMBNAIL_CONTAINER_WIDTH / THUMBNAIL_CONTENT_ASPECT_RATIO;

        function createThumbnailIframe(htmlContent) {
          const iframe = document.createElement("iframe");
          iframe.setAttribute("scrolling", "no");

          iframe.onload = () => {
            const iframeDocument =
              iframe.contentDocument || iframe.contentWindow.document;
            iframeDocument.open();
            iframeDocument.write(htmlContent);
            iframeDocument.close();

            if (iframeDocument.body && iframeDocument.body.firstChild) {
              const originalAssumedWidth = 800;
              const scaleFactor =
                THUMBNAIL_CONTAINER_WIDTH / originalAssumedWidth;

              iframeDocument.body.style.transformOrigin = "top left";
              iframeDocument.body.style.transform = `scale(${scaleFactor})`;
              iframeDocument.body.style.width = `${100 / scaleFactor}%`;
              iframeDocument.body.style.height = `${100 / scaleFactor}%`;
              iframeDocument.body.style.overflow = "hidden";
            }
          };

          return iframe;
        }

        function renderSlideList() {
          slideListEl.innerHTML = "";
          slides.forEach((htmlContent, index) => {
            const li = document.createElement("li");
            li.classList.toggle("active", index === currentSlide);

            const thumbContainer = document.createElement("div");
            thumbContainer.className = "thumbnail-container";
            thumbContainer.style.height = `${THUMBNAIL_CONTAINER_HEIGHT}px`;

            const iframe = createThumbnailIframe(htmlContent);
            thumbContainer.appendChild(iframe);
            li.appendChild(thumbContainer);

            const slideNum = document.createElement("span");
            slideNum.className = "slide-number";
            slideNum.textContent = `${index + 1}`;
            li.appendChild(slideNum);

            li.onclick = () => {
              currentSlide = index;
              popupEditor.value = slides[currentSlide];
              updateMainPreview();
              renderSlideList();
            };
            slideListEl.appendChild(li);
          });
          const activeLi = slideListEl.querySelector("li.active");
          if (activeLi) {
            activeLi.scrollIntoView({
              behavior: "smooth",
              block: "nearest",
              inline: "nearest",
            });
          }
        }

        function updateMainPreview() {
          const doc =
            previewFrame.contentDocument || previewFrame.contentWindow.document;
          doc.open();
          doc.write(slides[currentSlide]);
          doc.close();

          const activeThumbnail = slideListEl.querySelector(
            `li:nth-child(${currentSlide + 1}) iframe`
          );
          if (activeThumbnail) {
            const thumbDoc =
              activeThumbnail.contentDocument ||
              activeThumbnail.contentWindow.document;
            thumbDoc.open();
            thumbDoc.write(slides[currentSlide]);
            thumbDoc.close();
          }
        }

        function updatePresentation() {
          const doc =
            presentationIframe.contentDocument ||
            presentationIframe.contentWindow.document;
          doc.open();
          doc.write(slides[currentSlide]);
          doc.close();
        }

        function saveCurrentSlideContentFromPopup() {
          slides[currentSlide] = popupEditor.value;
        }

        function addSlide() {
          slides.push("");
          currentSlide = slides.length - 1;
          popupEditor.value = slides[currentSlide];
          updateMainPreview();
          renderSlideList();
        }

        function showPopup() {
          popupEditor.value = slides[currentSlide];
          popup.style.display = "flex";
        }

        function hidePopup() {
          popup.style.display = "none";
        }

        function savePopup() {
          saveCurrentSlideContentFromPopup();
          updateMainPreview();
          renderSlideList();
          hidePopup();
        }

        function togglePresentation() {
          if (presentationContainer.style.display === "flex") {
            exitPresentation();
          } else {
            currentSlide = 0;
            updatePresentation();
            presentationContainer.style.display = "flex";
            presentationIframe.requestFullscreen();
          }
        }

        function exitPresentation() {
          presentationContainer.style.display = "none";
          document.exitFullscreen();
        }

        function prevSlide() {
          if (currentSlide > 0) {
            currentSlide--;
            updatePresentation();
          }
        }

        function nextSlide() {
          if (currentSlide < slides.length - 1) {
            currentSlide++;
            updatePresentation();
          }
        }

        function init() {
          renderSlideList();
          updateMainPreview();
          popupEditor.value = slides[currentSlide];
        }

        return {
          addSlide,
          showPopup,
          hidePopup,
          savePopup,
          init,
          togglePresentation,
          prevSlide,
          nextSlide,
          exitPresentation,
        };
      })();

      Editor.init();
    </script>
  </body>
</html>
